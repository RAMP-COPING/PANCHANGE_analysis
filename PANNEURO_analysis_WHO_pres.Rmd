---
title: "PANNEURO_analysis"
author: "Christopher Huebel"
date: "Sys.Date()"
output:
  word_document:
    toc: yes
    toc_depth: '2'
  pdf_document:
    toc: yes
    toc_depth: '2'
  html_document:
    df_print: paged
    highlight: monochrome
    number_sections: no
    theme: cerulean
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: no
html_notebook:
  theme: cerulean
code_folding: show
toc: yes
---

Frequencies of neurological symptoms in participants of the COPING/RAMP studies

Filtered by participants that self-reported a swap or antibody test

and that answered the neurological questionnaire

Script written by C Huebel
Email: christopher.1.huebel@kcl.ac.uk

#Set up
```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      comment=NA,
                      prompt=FALSE,
                      cache=FALSE)


options(bitmapType = 'quartz') # to render fonts better
```

Clear global environment
```{r Clear global environment}
remove(list = ls())
```

Retrieve the current date to use it for file endings to not overwrite files when one exports files
```{r Recent date}
date = Sys.Date()
```

#Packages
Install packages (if they are not available in your version of R)
```{r Installing packages}
#install.packages("summarytools")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("broom")
#install.packages("skimr")
#install.packages("polycor")
#install.packages("corrplot")
#install.packages("patchwork")
#instlal.packages("ggpubr")
```

Load packages
```{r Load packages}
library(knitr)
library(summarytools)
library(psych)
library(polycor)
library(corrplot)
library(patchwork)
library(broom)
library(tidyverse)
library(ggpubr)
```

# Colour palettes
Define colours for plotting this are the standard coping colours
```{r Colour palettes: COPING}
COPINGpalette2 <- c("#78D9C5",
                    "#F5BE5E")

COPINGpalette3 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9")

COPINGpalette4 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9",
                    "#DBDB73")

COPINGpalette5 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9",
                    "#DBDB73", 
                    "#FFED98")

COPINGpalette6 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9",
                    "#DBDB73",
                    "#FFED98",
                    "#BFD2EB")

COPINGpalette7 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9",
                    "#DBDB73", 
                    "#FFED98",
                    "#BFD2EB", 
                    "#808080")

COPINGpaletteGRAD <- c("#F5BE5E",
                       "#FFD284",
                       "#FFEED1",
                       "#B5B5B5",
                       "#DEFFF8",
                       "#94F6E1",
                       "#78D9C5")

COPINGNeuCenterpalette <- c("#78D9C5",
                            "#808080",
                            "#F5BE5E")

RAMPworseGRADpalette <- c("#78D9C5",
                          "#FFEED1",
                          "#F5BE5E",
                          "#FFB1B5")
GLADpalette = c("#efc00b", 
                "#b7dee8")  
```

Choose in this chunk which palette to use
04.07.2020 - Default to 2 colour COPING palette
```{r Choose colour palette}
palette = COPINGpalette2
```

# ggplot theme
Set up ggplot theme for the plots
```{r ggplot theme}
theme_personal <-  theme(
    text = element_text(color = "black"),
    axis.title = element_text(color = "black"),
    axis.text = element_text(color = "black"),
    axis.title.y = element_blank(), 
    legend.background = element_blank(),
    legend.box.background = element_blank(),
    panel.background = element_blank(), 
    panel.grid.minor.x = element_blank(),
    panel.grid.major.x = element_line(
      colour = "gray",
      linetype = "dashed",
      size = 0.2
      ),
    axis.ticks = element_blank()
    )
```


# Data import

## Source data file paths 

```{r source file path}
#source data directory: data_path
source("../PANCHANGE_raw_path.R")
```


## Read in data
```{r read in data}
dat.raw <- readRDS(file = paste0(data_path, "/baseline_and_cfs_wave6.rds")) #NEEDS CHANGING
dim(dat.raw)
colnames(dat.raw)
```

## COVID swab test positive
```{r COVID positive swap}
dat.raw %>%
  count(respiratory.throat_swab_test_nose, Sample) %>%
  mutate(Prop = round(n/sum(n), 2))
```

## antibody test
```{r COVID positive antibody test}
dat.raw %>%
  count(respiratory.results_antibody_test, Sample) %>%
  mutate(Prop = round(n/sum(n), 2))
```

## COVID positive test (antibody or swab)
```{r create COVID positive test variable}
dat.raw <- dat.raw %>% 
  mutate(covid_test_positive = 
           case_when(
             respiratory.results_antibody_test == "Negative" & 
               respiratory.throat_swab_test_nose == "Negative" ~ 0,
             respiratory.results_antibody_test == "Positive" | 
               respiratory.throat_swab_test_nose == "Positive" ~ 1
           ))

dat.raw %>% 
  count(covid_test_positive)
```


## COVID probable diagnosis
```{r COVID probable diagnosis}
dat.raw %>%
  count(covid_probable_case_incl_screening, Sample) %>%
  mutate(Prop = round(n/sum(n), 2))

#Rough count
dat.raw %>%
  count(covid_probable_case_incl_screening)
```

## Cross table probable covid and covid test positive
```{r Cross table probable covid and covid test positive}
dat.raw %>%
  count(covid_test_positive, covid_probable_case_incl_screening) %>%
  spread(key = covid_test_positive, value = n)
```

# Demographics

## Age
## Proportion tables
```{r age_category per Sample prop per total}
age_category_per_Covid_prop_total <- dat.raw %>%
  count(age_category, covid_probable_case_incl_screening) %>%
  mutate(Prop = round(n/sum(n), 2))

kable(age_category_per_Covid_prop_total)
age_category_per_Covid_prop_total
```

```{r age_category per Sample prop per Sample}
age_category_per_Sample_prop_Sample <- dat.raw %>%
  group_by(Sample) %>%
  count(age_category, Sample) %>%
  mutate(Prop = round(n/sum(n), 2))

kable(age_category_per_Sample_prop_Sample)
age_category_per_Sample_prop_Sample
```

## Cross tables
```{r age_category per Sample prop cross table}
age_category_per_Sample_prop_Sample_cross_table <- dat.raw %>%
  group_by(Sample) %>%
  count(age_category, Sample) %>%
  mutate(Prop = round(n/sum(n), 2)) %>%
  pivot_wider(names_from = Sample, values_from = c(n, Prop))

kable(age_category_per_Sample_prop_Sample_cross_table)
age_category_per_Sample_prop_Sample_cross_table
```

## Sex
```{r sex according to probable Covid}
sex_category_per_Covid_prop_total <- dat.raw %>%
  filter(!is.na(Sex)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  count(Sex, covid_probable_case_incl_screening) %>%
  mutate(Prop = round(n/sum(n), 2))

kable(sex_category_per_Covid_prop_total)
sex_category_per_Covid_prop_total
```

## Smoking not available 


## BMI not available 

## Key worker status

```{r}
key_worker_category_per_Covid_prop_total <- dat.raw %>%
  filter(!is.na(key_worker)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  count(key_worker, covid_probable_case_incl_screening) %>%
  mutate(Prop = round(n/sum(n), 2))

kable(key_worker_category_per_Covid_prop_total)
key_worker_category_per_Covid_prop_total
```



## Smoking

## BMI

## Key worker status


## Ethnicity_collapsed
### Pie charts
```{r Collapse Ethnicity}
dat.raw <- dat.raw %>%
  mutate(Ethnicity_collapsed_numeric =
           case_when(
             Ethnicity_numeric == 1 ~ 0, #European
             Ethnicity_numeric == 2 ~ 1, #Mixed or multiple ethnic origins 
             Ethnicity_numeric == 3 ~ 2, #Asian or Asian British
             Ethnicity_numeric == 4 ~ 3, #African or African British
             Ethnicity_numeric == 5 ~ 3, #Arab - combined with African/African British
             Ethnicity_numeric == 6 ~ 4  #Other ethnic group
           )
  )

dat.raw <- dat.raw %>%
  mutate(Ethnicity_collapsed =
           recode_factor(
             Ethnicity_collapsed_numeric,
             `0` = "European",
             `1` = "Mixed or multiple ethnic origins",
             `2` = "Asian or Asian British",
             `3` = "African or African British",
             `4` = "Other"
           )
  )

dat.raw %>%
  freq(Ethnicity_collapsed)
```

```{r Ethnicity_collapsed prop per total summary}
Ethnicity_collapsed_prop_Covid <- dat.raw %>%
  count(covid_probable_case_incl_screening, Ethnicity_collapsed) %>%
  drop_na() %>%
  mutate(freq = round(n/sum(n), 2))
  
# total responders
ethN <- sum(Ethnicity_collapsed_prop_Covid$n)

kable(Ethnicity_collapsed_prop_Covid)
Ethnicity_collapsed_prop_Covid
```

pie chart with only European label

```{r ethnicity pie chart biggest group label}
Ethnicity_by_Covid_collapsed_count <- Ethnicity_collapsed_prop_Covid %>%
  mutate(Ethnicity_collapsed = fct_reorder(Ethnicity_collapsed,-n)) %>%
  group_by(covid_probable_case_incl_screening) %>% 
  ggplot(mapping = aes(
    x = Ethnicity_collapsed,
    y = n)
    ) +
  geom_bar(
    aes(fill = covid_probable_case_incl_screening),
    stat="identity",
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "Ethnicity",
    y = "Number of participants",
    fill = "Covid status") +
  theme_personal +
  scale_fill_manual(
    values = COPINGpalette4
    ) +
  coord_flip()

Ethnicity_by_Covid_collapsed_count

```



# Neurological frequencies
** NEED TO BE CHANGED TO covid_probable_case_incl_screening **
```{r neurological frequencies alsfrs}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  select(
    starts_with("alsfrs"),
    -ends_with("numeric")
  ) %>% 
  colnames()
```

alsfrs.limb_weakness_noticed_past,
alsfrs.normal,
alsfrs.slow_or_sloppy_all_words_are_legible,
alsfrs.not_all_words_are_legible,
alsfrs.able_to_grip_pen,
alsfrs.unable_to_grip_pen,
alsfrs.have_you_noticed_any_difficulty_walking,
alsfrs.do_you_have_any_difficulty_climbing_stairs


```{r neurological frequencies alsfrs.limb_weakness_noticed_past}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(alsfrs.limb_weakness_noticed_past)) %>%
  count(covid_probable_case_incl_screening, alsfrs.limb_weakness_noticed_past) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies alsfrs.normal}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(alsfrs.normal)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, alsfrs.normal) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies alsfrs.slow_or_sloppy_all_words_are_legible}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(alsfrs.slow_or_sloppy_all_words_are_legible)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, alsfrs.slow_or_sloppy_all_words_are_legible) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies alsfrs.not_all_words_are_legible}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(alsfrs.not_all_words_are_legible)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, alsfrs.not_all_words_are_legible) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies alsfrs.able_to_grip_pen}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(alsfrs.able_to_grip_pen)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, alsfrs.able_to_grip_pen) %>%
  mutate(Prop = round(n/sum(n), 2))
```


```{r neurological frequencies alsfrs.unable_to_grip_pen}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(alsfrs.unable_to_grip_pen)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, alsfrs.unable_to_grip_pen) %>%
  mutate(Prop = round(n/sum(n), 2))
```


```{r neurological frequencies alsfrs.have_you_noticed_any_difficulty_walking}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(alsfrs.have_you_noticed_any_difficulty_walking)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, alsfrs.have_you_noticed_any_difficulty_walking) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies alsfrs.do_you_have_any_difficulty_climbing_stairs}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(alsfrs.do_you_have_any_difficulty_climbing_stairs)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, alsfrs.do_you_have_any_difficulty_climbing_stairs) %>%
  mutate(Prop = round(n/sum(n), 2))
```


```{r neurological frequencies ess}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  select(
    starts_with("ess"),
    -ends_with("numeric")
  ) %>% 
  colnames()
```

```{r neurological frequencies ess.felt_excessively_sleepy_past}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.felt_excessively_sleepy_past)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.felt_excessively_sleepy_past) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.sitting_and_reading}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.sitting_and_reading)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.sitting_and_reading) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.watching_tv}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.watching_tv)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.watching_tv) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.sitting_inactive_in_a_public_place}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.sitting_inactive_in_a_public_place)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.sitting_inactive_in_a_public_place) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.break_passenger_car_hour}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.break_passenger_car_hour)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.break_passenger_car_hour) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.afternoon_rest_circumstances_lying}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.afternoon_rest_circumstances_lying)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.afternoon_rest_circumstances_lying) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.sitting_and_talking_to_someone}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.sitting_and_talking_to_someone)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.sitting_and_talking_to_someone) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.sitting_quietly_after_a_lunch_without_alcohol}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.sitting_quietly_after_a_lunch_without_alcohol)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.sitting_quietly_after_a_lunch_without_alcohol) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.car_minutes_stopped_traffic}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.car_minutes_stopped_traffic)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.car_minutes_stopped_traffic) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.insomnia}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.insomnia)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.insomnia) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.narcolepsy}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.narcolepsy)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.narcolepsy) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.rem_sleep_behaviour_disorder}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.rem_sleep_behaviour_disorder)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.rem_sleep_behaviour_disorder) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.restless_legs_syndrome}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.restless_legs_syndrome)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.restless_legs_syndrome) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.sleep_apnea}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.sleep_apnea)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.sleep_apnea) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.sleep_terrors}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.sleep_terrors)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.sleep_terrors) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.sleepwalking}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.sleepwalking)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.sleepwalking) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.other}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.other)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.other) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies ess.none}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.none)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.none) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies midas}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  select(
    starts_with("midas"),
    -ends_with("numeric")
  ) %>% 
  colnames()
```

```{r neurological frequencies midas.headaches_suffered_past_month}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(midas.headaches_suffered_past_month)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, midas.headaches_suffered_past_month) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies midas.days_past_month_miss_work_school}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(midas.days_past_month_miss_work_school)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, midas.days_past_month_miss_work_school) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies midas.days_past_month_work_school_half_productivity}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(midas.days_past_month_work_school_half_productivity)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, midas.days_past_month_work_school_half_productivity) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies midas.days_past_month_miss_housework}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(midas.days_past_month_miss_housework)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, midas.days_past_month_miss_housework) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies midas.days_past_month_housework_half_productivity}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(midas.days_past_month_housework_half_productivity)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, midas.days_past_month_housework_half_productivity) %>%
  mutate(Prop = round(n/sum(n), 2))
```


```{r neurological frequencies midas.days_past_month_miss_social_activities}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(midas.days_past_month_miss_social_activities)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, midas.days_past_month_miss_social_activities) %>%
  mutate(Prop = round(n/sum(n), 2))
```


```{r neurological frequencies nmss}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  select(
    starts_with("nmss"),
    -ends_with("numeric")
  ) %>% 
  colnames()
```


```{r neurological frequencies nmss.ability_taste_food_smell}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(nmss.ability_taste_food_smell)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, nmss.ability_taste_food_smell) %>%
  mutate(Prop = round(n/sum(n), 2))
```


```{r neurological frequencies nmss.severe_taste_smell_loss}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(nmss.severe_taste_smell_loss)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, nmss.severe_taste_smell_loss) %>%
  mutate(Prop = round(n/sum(n), 2))
```


```{r neurological frequencies nmsw}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  select(
    starts_with("nmsw"),
    -ends_with("numeric")
  ) %>% 
  colnames()
```

```{r neurological frequencies nmsw.drink_problems_choking_difficulty}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(nmsw.drink_problems_choking_difficulty)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, nmsw.drink_problems_choking_difficulty) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies nmsw.regularly_night_pass_urine}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(nmsw.regularly_night_pass_urine)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, nmsw.regularly_night_pass_urine) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies nmsw.sex_difficult_finding}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(nmsw.sex_difficult_finding)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, nmsw.sex_difficult_finding) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies nmsw.weak_standing_feeling_light}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(nmsw.weak_standing_feeling_light)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, nmsw.weak_standing_feeling_light) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies nmsw.acting_moving_sleep_talking}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(nmsw.acting_moving_sleep_talking)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, nmsw.acting_moving_sleep_talking) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies nmsw.double_vision}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(nmsw.double_vision)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, nmsw.double_vision) %>%
  mutate(Prop = round(n/sum(n), 2))
```


```{r neurological frequencies tinnitus}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  select(
    starts_with("tinnitus"),
    -ends_with("numeric")
  ) %>% 
  colnames()
```

```{r neurological frequencies tinnitus.ears_noises_minutes_head}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(tinnitus.ears_noises_minutes_head)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, tinnitus.ears_noises_minutes_head) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies tinnitus.ears_noises_minutes_head_frequency}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(tinnitus.ears_noises_minutes_head_frequency)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, tinnitus.ears_noises_minutes_head_frequency) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r neurological frequencies tinnitus.noises_worry_worst_upset}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(tinnitus.noises_worry_worst_upset)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, tinnitus.noises_worry_worst_upset) %>%
  mutate(Prop = round(n/sum(n), 2))
```

**ADD SCORING FOR NEURO MEASURES**
# ALSfrs
```{ALSfrs col names r}
als.col.names <- dat.raw %>%
  select(
    starts_with("alsfrs") & ends_with("numeric")
  ) %>%
  colnames()

```

```{ALSfrs row sums r}
dat.raw <- dat.raw %>%
  mutate(als.sum.score =
  rowSums(select(.,als.col.names), na.rm = F)
   )
```

```{ALSfrs frequencies r}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(als.sum.score)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, als.sum.score) %>%
  mutate(Prop = round(n/sum(n), 2)) 

```
# ESS
```{ESS col names r}
ess.col.names <- dat.raw %>%
  select(
    starts_with("ess") & ends_with("numeric")
  ) %>%
  colnames()

```

```{ESS row sums r}
dat.raw <- dat.raw %>%
  mutate(ess.col.names =
   rowSums(select(.,ess.col.names), na.rm = F)
   )
```

```{ESS frequencies r}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(ess.col.names)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, ess.col.names) %>%
  mutate(Prop = round(n/sum(n), 2))
```

```{r nmsw col names}
nmsw.col.names <- dat.raw %>%
  select(
    starts_with("nmsw") & ends_with("numeric")
  ) %>% 
  colnames()
nmsw.col.names

```

```{r scoring NMSW}
dat.raw <- dat.raw %>% 
  mutate(nmsw.sum_score = 
           rowSums(select(.,nmsw.col.names), na.rm = FALSE)
           )

```



## CFS

```{r}
cfs.col.names <- dat.raw %>%
  select(
    starts_with("cfs") & ends_with("numeric")
  ) %>%
  colnames()
cfs.col.names
```
```{r}
dat.raw <- dat.raw %>%
  mutate(cfs.sum_score =
   rowSums(select(.,cfs.col.names), na.rm = F) - 11
   )
cfs.col.names.physio <- cfs.col.names[1:7]

dat.raw <- dat.raw <- dat.raw %>%
  mutate(cfs.sum_score_physical=
   rowSums(select(.,cfs.col.names.physio), na.rm = F) - 7
   )

cfs.col.names.psych <- cfs.col.names[8:11]

dat.raw <- dat.raw <- dat.raw %>%
  mutate(cfs.sum_score_psyhchological =
   rowSums(select(.,cfs.col.names.psych), na.rm = F) -4
   )
```

```{r}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(cfs.sum_score)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  summarise(mean_total = mean(cfs.sum_score, na.rm = TRUE),
            mean_physical = mean(cfs.sum_score_physical, na.rm = TRUE),
            mean_psychological = mean (cfs.sum_score_psyhchological, na.rm = TRUE)) 

```

```{r}
dat.raw$cfs.correct_word_find_difficult_binary <- if_else(dat.raw$cfs.correct_word_find_difficult_numeric >= 3, 1,0)
dat.raw$cfs.do_you_have_problems_with_tiredness_binary<- if_else(dat.raw$cfs.do_you_have_problems_with_tiredness_numeric >= 3, 1,0)
dat.raw$cfs.do_you_feel_sleepy_or_drowsy_binary <- if_else(dat.raw$cfs.do_you_feel_sleepy_or_drowsy_numeric >= 3, 1,0)
dat.raw$cfs.do_you_feel_weak_binary <- if_else(dat.raw$cfs.do_you_feel_weak_numeric >= 3, 1,0)
dat.raw$cfs.do_you_have_difficulty_concentrating_binary <- if_else(dat.raw$cfs.do_you_have_difficulty_concentrating_numeric >= 3, 1,0)
dat.raw$cfs.do_you_have_problems_starting_things_binary <- if_else(dat.raw$cfs.do_you_have_problems_starting_things_numeric >= 3, 1,0)
dat.raw$cfs.do_you_lack_energy_binary <- if_else(dat.raw$cfs.do_you_lack_energy_numeric >= 3, 1,0)
dat.raw$cfs.do_you_need_to_rest_more_binary <- if_else(dat.raw$cfs.do_you_need_to_rest_more_numeric >= 3, 1,0)
dat.raw$cfs.how_is_your_memory_numeric_binary <- if_else(dat.raw$cfs.how_is_your_memory_numeric >= 3, 1,0) 
dat.raw$cfs.make_slips_speaking_tongue_binary <- if_else(dat.raw$cfs.make_slips_speaking_tongue_numeric >= 3, 1,0)
dat.raw$cfs.strength_muscles_binary <- if_else(dat.raw$cfs.strength_muscles_numeric >= 3, 1,0)
```

```{r}
cfs.col.names.bi <- dat.raw %>%
  select(
    starts_with("cfs") & ends_with("binary")
  ) %>%
  colnames()
cfs.col.names.bi
```
```{r}
dat.raw <- dat.raw %>%
  mutate(cfs.sum_score_binary =
   rowSums(select(.,cfs.col.names.bi), na.rm = F) 
   )

dat.raw <- dat.raw %>%
  mutate(cfs.sum_score_case = if_else(cfs.sum_score_binary >= 4, "Fatigue", "No fatigue")) 
   
```

```{r}
dat.raw %>%
  filter(!is.na(startDate.coping)) %>%
  filter(!is.na(covid_probable_case_incl_screening)) %>%
  filter(!is.na(cfs.sum_score_case)) %>%
  group_by(covid_probable_case_incl_screening) %>%
  count(covid_probable_case_incl_screening, cfs.sum_score_case) %>%
  mutate(Prop = round(n/sum(n), 2))
```

