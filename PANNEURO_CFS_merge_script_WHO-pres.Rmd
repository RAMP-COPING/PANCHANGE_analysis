---
title: "Data merging for WHO presentation"
author: "Christopher Huebel and Molly Davies"
date: "17/08/2020"
output: html_document
---

This is the preprocessing script to prepare the data to run analyses for the project "Anxiety, depression and trauma symptom change during the COVID-19 pandemic: retrospective versus objective assessment" - Young et al (2020)

Script written by K Purves, K Thompson, C Huebel and M Davies.
Email: kirstin.purves@kcl.ac.uk, katie.thompson@kcl.ac.uk, christopher.1.huebel@kcl.ac.uk, molly.davies@kcl.ac.uk



#Set up
```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      comment=NA,
                      prompt=FALSE,
                      cache=FALSE)


options(bitmapType = 'quartz') # to render fonts better
```

Clear global environment
```{r Clear global environment}
remove(list = ls())
```

Retrieve the current date to use it for file endings to not overwrite files when one exports files
```{r Recent date}
date = Sys.Date()
```


Load packages
```{r}
library(tidyverse)
library(skimr)
```

# Source data file paths 

```{r source file path}
#source raw data directory: data.raw_path
source("../PANCHANGE_raw_path.R")
```



# Import data
```{r import data}
coping_baseline <- read_rds(path = paste0(data_path, "/four_cohorts.rds"))
dim(coping_baseline)

cfs_wave6 <- read_rds(path = paste0(data_path, "/cfs_wave6.rds"))
dim(cfs_wave6)

bmi_data <- read_rds(path = paste0(data_path, "/bmi.rds"))

```

```{r rename NBR cohort in bmi dataset}
bmi_data <- bmi_data%>%
  mutate(
    Sample = 
    recode(
      Sample, 
      "SP0068" = "NBR"
    )
  )
```

```{r merge data frames}
dat1 <- left_join(
  coping_baseline,
  cfs_wave6, by = c("Sample", "ID")
)

dat <- left_join(
  dat1,
  bmi_data,
  by = c("Sample", "ID")
)

```

```{r Skim data}
#look at the data 
#skimr::skim(dat) #(too big to run)
dim(dat)
```

```{r Save four cohorts as rds file}
saveRDS(object = dat, file = paste0(data_path, "/baseline_and_cfs_wave6.rds"))
```

