---
title: "PANCHANGE_analysis"
author: "Katie Thompson, Topher Huebel, Molly Davies, Kirstin Purves"
date: Sys.Date()
output:  
  html_document:
    df_print: paged
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: false
    number_sections: false
    highlight: monochrome
    theme: cerulean
code_folding: show

html_notebook:
  theme: cerulean
toc: yes
---

This is the analysis script to prepare the data to run analyses for the project "Anxiety, depression and trauma symptom change during the COVID-19 pandemic: retrospective versus objective assessment" - Young et al (2020)

Script written by K Purves, K Thompson, C Huebel and M Davies.
Email: kirstin.purves@kcl.ac.uk, katie.thompson@kcl.ac.uk, christopher.1.huebel@kcl.ac.uk, molly.davies@kcl.ac.uk

#Set up
```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      comment=NA,
                      prompt=FALSE,
                      cache=FALSE)


options(bitmapType = 'quartz') # to render fonts better
```

Clear global environment
```{r Clear global environment}
remove(list = ls())
```

Retrieve the current date to use it for file endings to not overwrite files when one exports files
```{r Recent date}
date = Sys.Date()
```

#Packages
Install packages (if they are not available in your version of R)
```{r Installing packages}
#install.packages("summarytools")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("broom")
#install.packages("skimr")
#install.packages("polycor")
#install.packages("corrplot")
#install.packages("patchwork")
#instlal.packages("ggpubr")
```

Load packages
```{r Load packages}
library(knitr)
library(summarytools)
library(psych)
library(polycor)
library(corrplot)
library(patchwork)
library(broom)
library(tidyverse)
library(ggpubr)
```

# Colour palettes
Define colours for plotting this are the standard coping colours
```{r Colour palettes: COPING}
COPINGpalette2 <- c("#78D9C5",
                    "#F5BE5E")

COPINGpalette3 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9")

COPINGpalette4 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9",
                    "#DBDB73")

COPINGpalette5 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9",
                    "#DBDB73", 
                    "#FFED98")

COPINGpalette6 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9",
                    "#DBDB73",
                    "#FFED98",
                    "#BFD2EB")

COPINGpalette7 <- c("#78D9C5",
                    "#F5BE5E",
                    "#EEB6E9",
                    "#DBDB73", 
                    "#FFED98",
                    "#BFD2EB", 
                    "#808080")

COPINGpaletteGRAD <- c("#F5BE5E",
                       "#FFD284",
                       "#FFEED1",
                       "#B5B5B5",
                       "#DEFFF8",
                       "#94F6E1",
                       "#78D9C5")

COPINGNeuCenterpalette <- c("#78D9C5",
                            "#808080",
                            "#F5BE5E")

RAMPworseGRADpalette <- c("#78D9C5",
                          "#FFEED1",
                          "#F5BE5E",
                          "#FFB1B5")
GLADpalette = c("#efc00b", 
                "#b7dee8")  
```

Choose in this chunk which palette to use
04.07.2020 - Default to 2 colour COPING palette
```{r Choose colour palette}
palette = COPINGpalette2
```

# ggplot theme
Set up ggplot theme for the plots
```{r ggplot theme}
theme_personal <-  theme(
    text = element_text(color = "black"),
    axis.title = element_text(color = "black"),
    axis.text = element_text(color = "black"),
    axis.title.y = element_blank(), 
    legend.background = element_blank(),
    legend.box.background = element_blank(),
    panel.background = element_blank(), 
    panel.grid.minor.x = element_blank(),
    panel.grid.major.x = element_line(
      colour = "gray",
      linetype = "dashed",
      size = 0.2
      ),
    axis.ticks = element_blank()
    )
```



# Data import

## Source data file paths 

```{r source file path}
#source data directory: data_path
source("../PANCHANGE_raw_path.R")
```


## Read in data
```{r read in data}
dat.raw <- readRDS(file = paste0(data_path, "/four_cohorts.rds"))
dim(dat.raw)
colnames(dat.raw)
```


# Vectors for sum_score

```{r Vectors with sum_score_cols}
sum_score_cols <- dat %>%
  select(contains("sum_score")) %>%
  select(-ends_with("raw")) %>%
  colnames()

sum_score_cols

phq.sum_score_cols <- dat %>%
  select(contains("phq")) %>%
  select(contains("sum_score")) %>% 
  select(-ends_with("raw")) %>%
  select(-contains("8items")) %>%
  colnames()

phq.sum_score_cols

gad.sum_score_cols <- dat %>%
  select(contains("gad")) %>%
  select(contains("sum_score")) %>% 
  select(-ends_with("raw")) %>%
  colnames()

gad.sum_score_cols

ocir.sum_score_cols <- dat %>%
  select(contains("ocir")) %>%
  select(contains("sum_score")) %>% 
  select(-ends_with("raw")) %>%
  colnames()

ocir.sum_score_cols

pcl.sum_score_cols <- dat %>%
  select(contains("pcl")) %>%
  select(contains("sum_score")) %>% 
  select(-ends_with("raw")) %>%
  colnames()

pcl.sum_score_cols
```

# Vectors for diff_score

```{r Vectors with diff_score_cols}
diff_score_cols <- dat %>%
  select(contains("diff_score")) %>% 
  colnames()

diff_score_cols

phq.diff_score_cols <- dat %>%
  select(contains("phq")) %>%
  select(contains("diff_score")) %>% 
  colnames()

phq.diff_score_cols

gad.diff_score_cols <- dat %>%
  select(contains("gad")) %>%
  select(contains("diff_score")) %>% 
  colnames()

gad.diff_score_cols

ocir.diff_score_cols <- dat %>%
  select(contains("ocir")) %>%
  select(contains("diff_score")) %>% 
  colnames()

ocir.diff_score_cols
```


# Questionnaire comparions

## gad
### Summary scores
```{r descriptives gad.sum_score_cols}
gad.sum_score_numeric_table <- dat %>% 
  group_by(gad.change_binary) %>%
  summarise_at( 
    vars(
      "Prepan" = gad.sum_score_prepan,
      "Base" = gad.sum_score_base,
      "Retro" = gad.sum_score_retro
    ),
    .funs =
      list(
        ~mean(., na.rm = T),
        ~sd(., na.rm = T),
        ~median(., na.rm = T),
        ~min(., na.rm = T),
        ~max(., na.rm = T),
        ~skew(., na.rm = T),
        kurtosis = ~kurtosi(., na.rm = T)
      )
  )

gad.sum_score_numeric_table
```

```{r gad sum score smart numeric summary tables}
# reshape the table
gad.sum_score_numeric_summary_table_reshaped <- gad.sum_score_numeric_table %>% 
  gather(key, value, -gad.change_binary) %>% 
  separate(key, c("variable", "measure"), sep = "_") %>%
  mutate(measure = factor(
    x = measure,
    levels =  c( # this is the order I want my columns to appear in
      "missing",
      "min",
      "max",
      "mean", 
      "median", 
      "mode",
      "sd",
      "skew",
      "kurtosis"
    ))) %>% 
  spread(measure, value) %>% 
  # we can apply a function to all variables to edit them so that they are publication ready
  rename_all(
    .funs = ~str_to_title(.)
  ) %>% 
  # or we can individually rename variables 
  rename(
    Change = Gad.change_binary,
    SD = Sd
  ) 

gad.sum_score_numeric_summary_table_reshaped
```

Table for knitting
gad sum score summary table
```{r gad sum score summary table}
kable(gad.sum_score_numeric_summary_table_reshaped)
```

### Differences scores

```{r descriptives gad.diff_score_cols}
gad.numeric_table <- dat %>% 
  group_by(gad.change_binary) %>%
  summarise_at( 
    vars(
      "Base - prepan" = gad.diff_score_base_prepan,
      "Base - retro" = gad.diff_score_base_retro,
      "Prepan - retro" = gad.diff_score_retro_prepan
    ),
    .funs =
      list(
        ~mean(., na.rm = T),
        ~sd(., na.rm = T),
        ~median(., na.rm = T),
        ~min(., na.rm = T),
        ~max(., na.rm = T),
        ~skew(., na.rm = T),
        kurtosis = ~kurtosi(., na.rm = T)
      )
  )

gad.numeric_table
```

```{r gad diff score smart numeric summary tables}
# reshape the table
gad.numeric_summary_table_reshaped <- gad.numeric_table %>% 
  gather(key, value, -gad.change_binary) %>% 
  separate(key, c("variable", "measure"), sep = "_") %>%
  mutate(measure = factor(
    x = measure,
    levels =  c( # this is the order I want my columns to appear in
      "missing",
      "min",
      "max",
      "mean", 
      "median", 
      "mode",
      "sd",
      "skew",
      "kurtosis"
    ))) %>% 
  spread(measure, value) %>% 
  # we can apply a function to all variables to edit them so that they are publication ready
  rename_all(
    .funs = ~str_to_title(.)
    ) %>% 
  # or we can individually rename variables 
  rename(
    Change = Gad.change_binary,
    SD = Sd
  ) 
  
gad.numeric_summary_table_reshaped
```

Table for knitting
gad diff summary table
```{r gad diff summary table}
kable(gad.numeric_summary_table_reshaped)
```

### Long format

```{r gad gather to long format Time_points gad.diff_score}
dat.long.gad.diff <- dat %>%
  gather(
    key = "Time_point_raw",
    value = "gad.diff_score",
    all_of(gad.diff_score_cols)) %>%
  select(
    ID,
    Sample,
    Gender_collapsed,
    Ethnicity_collapsed,
    Disorder_hierarchical,
    Time_point_raw,
    gad.diff_score
  ) %>%
  mutate(Time_point = str_replace(Time_point_raw, "gad.diff_score_", "")) %>%
  select(-Time_point_raw)

head(dat.long.gad.diff)
```

```{r gad gather to long format Time_points gad.sum_score}
dat.long.gad.sum <- dat %>%
  gather(
    key = "Time_point_raw",
    value = "gad.sum_score",
    all_of(gad.sum_score_cols)) %>%
  select(
    ID,
    Sample,
    Gender_collapsed,
    Ethnicity_collapsed,
    Disorder_hierarchical,
    Time_point_raw,
    gad.sum_score
  ) %>%
  mutate(Time_point = str_replace(Time_point_raw, "gad.sum_score_", "")) %>%
  select(-Time_point_raw)

head(dat.long.gad.sum)
```


### Plots diff

makes this into percentages
```{r gad absolut plot}
dat.long.gad.diff %>%
  ggplot(mapping = aes(y = gad.diff_score)) +
  geom_bar() +
  theme_minimal() +
  facet_wrap(facets = vars(Time_point))
```

```{r gad percentage plot retro_prepan diff}
dat.long.gad.diff %>%
  filter(Time_point != "retro_prepan") %>%
  ggplot(mapping = aes(
    x = gad.diff_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "Difference GAD7 score",
    y = "Percentage of participants",
    fill = "Comparison:\nBaseline vs") +
  theme_personal +
  scale_fill_manual(values = palette, labels = c("Prepandemic", "Retrospective"))
```


```{r gad percentage plot retro_prepan resized, fig.height=6, fig.width=10}
dat.long.gad.diff %>%
  filter(Time_point != "retro_prepan") %>%
  ggplot(mapping = aes(
    x = gad.diff_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "Difference GAD7 score",
    y = "Percentage of participants",
    fill = "Comparison:\nBaseline vs") +
  theme_personal +
  scale_fill_manual(values = palette, labels = c("Prepandemic", "Retrospective")) +
  facet_wrap("Disorder_hierarchical")
```



```{r gad plot retro_prepan diff}
dat.long.gad.diff %>%
  filter(Time_point == "retro_prepan") %>%
  ggplot(mapping = aes(
    x = gad.diff_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "Difference GAD7 score",
    y = "Percentage of participants",
    fill = "Comparison:\nRetrospective vs") +
  theme_personal +
  scale_fill_manual(values = palette, labels = c("Prepandemic"))
```

### Plots sum

```{r gad percentage plot retro_prepan sum}
dat.long.gad.sum %>%
#  filter(Time_point != "retro_prepan") %>%
  ggplot(mapping = aes(
    x = gad.sum_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "GAD7 scores",
    y = "Percentage of participants",
    fill = "Time point") +
  theme_personal +
  scale_fill_manual(
    values = COPINGpalette3,
    labels = c("Baseline", "Prepandemic", "Retrospective")
    )
```

```{r gad percentage plot retro_prepan sum resized, fig.height=6, fig.width=10}
dat.long.gad.sum %>%
#  filter(Time_point != "retro_prepan") %>%
  ggplot(mapping = aes(
    x = gad.sum_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "GAD7 score",
    y = "Percentage of participants",
    fill = "Time point") +
  theme_personal +
  scale_fill_manual(
    values = COPINGpalette3,
#    labels = c("Prepandemic", "Retrospective")
    ) +
  facet_wrap("Disorder_hierarchical")
```


## phq

### Summary scores
```{r descriptives phq.sum_score}
phq.sum_score_numeric_table <- dat %>% 
  group_by(phq.change_binary) %>%
  summarise_at( 
    vars(
      "Prepan" = phq.sum_score_prepan,
      "Base" = phq.sum_score_base,
      "Retro" = phq.sum_score_retro
    ),
    .funs =
      list(
        ~mean(., na.rm = T),
        ~sd(., na.rm = T),
        ~median(., na.rm = T),
        ~min(., na.rm = T),
        ~max(., na.rm = T),
        ~skew(., na.rm = T),
        kurtosis = ~kurtosi(., na.rm = T)
      )
  )

phq.sum_score_numeric_table
```

```{r phq sum score smart numeric summary tables}
# reshape the table
phq.sum_score_numeric_summary_table_reshaped <- phq.sum_score_numeric_table %>%
  gather(key, value, -phq.change_binary) %>% 
  separate(key, c("variable", "measure"), sep = "_") %>%
  mutate(measure = factor(
    x = measure,
    levels =  c( # this is the order I want my columns to appear in
      "missing",
      "min",
      "max",
      "mean", 
      "median", 
      "mode",
      "sd",
      "skew",
      "kurtosis"
    ))) %>% 
  spread(measure, value) %>% 
  # we can apply a function to all variables to edit them so that they are publication ready
  rename_all(
    .funs = ~str_to_title(.)
  ) %>% 
  # or we can individually rename variables 
  rename(
    SD = Sd
  ) 

phq.sum_score_numeric_summary_table_reshaped
```

Table for knitting
phq sum score summary table
```{r phq sum score summary table}
kable(phq.sum_score_numeric_summary_table_reshaped)
```

### Differences score

```{r descriptives phq.diff_score_cols}
phq.numeric_table <- dat %>% 
  group_by(phq.change_binary) %>%
  summarise_at( 
    vars(
      "Base - prepan" = phq.diff_score_base_prepan,
      "Base - retro" = phq.diff_score_base_retro,
      "Prepan - retro" = phq.diff_score_retro_prepan
    ),
    .funs =
      list(
        ~mean(., na.rm = T),
        ~sd(., na.rm = T),
        ~median(., na.rm = T),
        ~min(., na.rm = T),
        ~max(., na.rm = T),
        ~skew(., na.rm = T),
        kurtosis = ~kurtosi(., na.rm = T)
      )
  )

phq.numeric_table
```

```{r phq diff score smart numeric summary tables}
# reshape the table
phq.numeric_summary_table_reshaped <- phq.numeric_table %>% 
  gather(key, value, -phq.change_binary) %>% 
  separate(key, c("variable", "measure"), sep = "_") %>%
  mutate(measure = factor(
    x = measure,
    levels =  c( # this is the order I want my columns to appear in
      "missing",
      "min",
      "max",
      "mean", 
      "median", 
      "mode",
      "sd",
      "skew",
      "kurtosis"
    ))) %>% 
  spread(measure, value) %>% 
  # we can apply a function to all variables to edit them so that they are publication ready
  rename_all(
    .funs = ~str_to_title(.)
  ) %>% 
  # or we can individually rename variables 
  rename(
    SD = Sd
  ) 

phq.numeric_summary_table_reshaped
```

Table for knitting
phq diff summary table
```{r phq diff summary table}
kable(phq.numeric_summary_table_reshaped)
```

### Long format

```{r phq gather to long format Time_points}
dat.long.phq.diff <- dat %>%
  gather(
    key = "Time_point_raw",
    value = "phq.diff_score",
    all_of(phq.diff_score_cols)) %>%
  select(
    ID,
    Sample,
    Gender_collapsed,
    Ethnicity_collapsed,
    Disorder_hierarchical,
    Time_point_raw,
    phq.diff_score
  ) %>%
  mutate(Time_point = str_replace(Time_point_raw, "phq.diff_score_", "")) %>%
  select(-Time_point_raw)

head(dat.long.phq.diff)
```

```{r phq gather to long format Time_points phq.sum_score}
dat.long.phq.sum <- dat %>%
  gather(
    key = "Time_point_raw",
    value = "phq.sum_score",
    all_of(phq.sum_score_cols)) %>%
  select(
    ID,
    Sample,
    Gender_collapsed,
    Ethnicity_collapsed,
    Disorder_hierarchical,
    Time_point_raw,
    phq.sum_score
  ) %>%
  mutate(Time_point = str_replace(Time_point_raw, "phq.sum_score_", "")) %>%
  select(-Time_point_raw)

head(dat.long.phq.sum)
```

### Plots

makes this into percentages
```{r phq absolut plot}
dat.long.phq.diff %>%
  ggplot(mapping = aes(y = phq.diff_score)) +
  geom_bar() +
  theme_minimal() +
  facet_wrap(facets = vars(Time_point))
```


```{r phq percentage plot retro_prepan}
dat.long.phq.diff %>%
  filter(Time_point != "retro_prepan") %>%
  ggplot(mapping = aes(
    x = phq.diff_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "Difference PHQ9 score",
    y = "Percentage of participants",
    fill = "Comparison:\nBaseline vs") +
  theme_personal +
  scale_fill_manual(values = palette, labels = c("Prepandemic", "Retrospective"))
```

```{r phq plot retro_prepan diff}
dat.long.phq.diff %>%
  filter(Time_point == "retro_prepan") %>%
  ggplot(mapping = aes(
    x = phq.diff_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "Difference phq7 score",
    y = "Percentage of participants",
    fill = "Comparison:\nPrepandemic vs") +
  theme_personal +
  scale_fill_manual(values = palette, labels = c("Retrospective"))
```

```{r phq percentage plot retro_prepan resized, fig.height=6, fig.width=10}
dat.long.phq.diff %>%
  filter(Time_point != "retro_prepan") %>%
  ggplot(mapping = aes(
    x = phq.diff_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "Difference PHQ9 score",
    y = "Percentage of participants",
    fill = "Comparison:\nBaseline vs") +
  theme_personal +
  scale_fill_manual(values = palette, labels = c("Prepandemic", "Retrospective")) +
  facet_wrap("Disorder_hierarchical")
```

### Plots sum

```{r phq percentage plot retro_prepan sum}
dat.long.phq.sum %>%
  #  filter(Time_point != "retro_prepan") %>%
  ggplot(mapping = aes(
    x = phq.sum_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "PHQ9 scores",
    y = "Percentage of participants",
    fill = "Time point") +
  theme_personal +
  scale_fill_manual(
    values = COPINGpalette3,
    labels = c("Baseline", "Prepandemic", "Retrospective")
  )
```

```{r phq percentage plot retro_prepan sum resized, fig.height=6, fig.width=10}
dat.long.phq.sum %>%
  #  filter(Time_point != "retro_prepan") %>%
  ggplot(mapping = aes(
    x = phq.sum_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "PHQ9 score",
    y = "Percentage of participants",
    fill = "Time point") +
  theme_personal +
  scale_fill_manual(
    values = COPINGpalette3,
    labels = c("Baseline", "Prepandemic", "Retrospective")
  ) +
  facet_wrap("Disorder_hierarchical")
```

## ocir

### Summary scores
```{r descriptives ocir.sum_score}
ocir.sum_score_numeric_table <- dat %>% 
  group_by(ocir.change_binary) %>%
  summarise_at( 
    vars(
      "Prepan" = ocir.sum_score_prepan,
      "Base" = ocir.sum_score_base,
      "Retro" = ocir.sum_score_retro
    ),
    .funs =
      list(
        ~mean(., na.rm = T),
        ~sd(., na.rm = T),
        ~median(., na.rm = T),
        ~min(., na.rm = T),
        ~max(., na.rm = T),
        ~skew(., na.rm = T),
        kurtosis = ~kurtosi(., na.rm = T)
      )
  )

ocir.sum_score_numeric_table
```

```{r ocir sum score smart numeric summary tables}
# reshape the table
ocir.sum_score_numeric_summary_table_reshaped <- ocir.sum_score_numeric_table %>%
  filter(ocir.change_binary == "Worsening") %>%
  select(-ocir.change_binary) %>%
  gather(key, value) %>% 
  separate(key, c("variable", "measure"), sep = "_") %>%
  mutate(measure = factor(
    x = measure,
    levels =  c( # this is the order I want my columns to appear in
      "missing",
      "min",
      "max",
      "mean", 
      "median", 
      "mode",
      "sd",
      "skew",
      "kurtosis"
    ))) %>% 
  spread(measure, value) %>% 
  # we can apply a function to all variables to edit them so that they are publication ready
  rename_all(
    .funs = ~str_to_title(.)
  ) %>% 
  # or we can individually rename variables 
  rename(
    SD = Sd
  ) 

ocir.sum_score_numeric_summary_table_reshaped
```

Table for knitting
ocir sum score summary table
```{r ocir sum score summary table}
kable(ocir.sum_score_numeric_summary_table_reshaped)
```

### Differences scores

```{r descriptives ocir.diff_score_cols}
ocir.numeric_table <- dat %>% 
  #  group_by(dem.sex) %>%
  summarise_at( 
    vars(
      "Base - prepan" = ocir.diff_score_base_prepan,
      "Base - retro" = ocir.diff_score_base_retro,
      "Prepan - retro" = ocir.diff_score_retro_prepan
    ),
    .funs =
      list(
        ~mean(., na.rm = T),
        ~sd(., na.rm = T),
        ~median(., na.rm = T),
        ~min(., na.rm = T),
        ~max(., na.rm = T),
        ~skew(., na.rm = T),
        kurtosis = ~kurtosi(., na.rm = T)
      )
  )

ocir.numeric_table
```

```{r ocir diff score smart numeric summary tables}
# reshape the table
ocir.numeric_summary_table_reshaped <- ocir.numeric_table %>% 
  gather(key, value) %>% 
  separate(key, c("variable", "measure"), sep = "_") %>%
  mutate(measure = factor(
    x = measure,
    levels =  c( # this is the order I want my columns to appear in
      "missing",
      "min",
      "max",
      "mean", 
      "median", 
      "mode",
      "sd",
      "skew",
      "kurtosis"
    ))) %>% 
  spread(measure, value) %>% 
  # we can apply a function to all variables to edit them so that they are publication ready
  rename_all(
    .funs = ~str_to_title(.)
  ) %>% 
  # or we can individually rename variables 
  rename(
    SD = Sd
  ) 

ocir.numeric_summary_table_reshaped
```

Table for knitting
ocir diff summary table
```{r ocir diff summary table}
kable(ocir.numeric_summary_table_reshaped)
```

### Long format

```{r ocir gather to long format Time_points}
dat.long.ocir.diff <- dat %>%
  gather(
    key = "Time_point_raw",
    value = "ocir.diff_score",
    all_of(ocir.diff_score_cols)) %>%
  select(
    ID,
    Sample,
    Gender_collapsed,
    Ethnicity_collapsed,
    Disorder_hierarchical,
    Time_point_raw,
    ocir.diff_score
  ) %>%
  mutate(Time_point = str_replace(Time_point_raw, "ocir.diff_score_", "")) %>%
  select(-Time_point_raw)

head(dat.long.ocir.diff)
```

```{r ocir gather to long format Time_points ocir.sum_score}
dat.long.ocir.sum <- dat %>%
  gather(
    key = "Time_point_raw",
    value = "ocir.sum_score",
    all_of(ocir.sum_score_cols)) %>%
  select(
    ID,
    Sample,
    Gender_collapsed,
    Ethnicity_collapsed,
    Disorder_hierarchical,
    Time_point_raw,
    ocir.sum_score
  ) %>%
  mutate(Time_point = str_replace(Time_point_raw, "ocir.sum_score_", "")) %>%
  select(-Time_point_raw)

head(dat.long.ocir.sum)
```

### Plots

makes this into percentages
```{r ocir absolut plot}
dat.long.ocir.diff %>%
  ggplot(mapping = aes(y = ocir.diff_score)) +
  geom_bar() +
  theme_minimal() +
  facet_wrap(facets = vars(Time_point))
```

```{r ocir percentage plot retro_prepan}
dat.long.ocir.diff %>%
  filter(Time_point != "retro_prepan") %>%
  ggplot(mapping = aes(
    x = ocir.diff_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "Difference OCI-R score",
    y = "Percentage of participants",
    fill = "Comparison:\nBaseline vs") +
  theme_personal +
  scale_fill_manual(values = palette, labels = c("Prepandemic", "Retrospective"))
```

```{r ocir plot retro_prepan diff}
dat.long.ocir.diff %>%
  filter(Time_point == "retro_prepan") %>%
  ggplot(mapping = aes(
    x = ocir.diff_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "Difference ocir7 score",
    y = "Percentage of participants",
    fill = "Comparison:\nPrepandemic vs") +
  theme_personal +
  scale_fill_manual(values = palette, labels = c("Retrospective"))
```

```{r ocir percentage plot retro_prepan resized, fig.height=6, fig.width=10}
dat.long.ocir.diff %>%
  filter(Time_point != "retro_prepan") %>%
  ggplot(mapping = aes(
    x = ocir.diff_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "Difference OCI-R score",
    y = "Percentage of participants",
    fill = "Comparison:\nBaseline vs") +
  theme_personal +
  scale_fill_manual(values = palette, labels = c("Prepandemic", "Retrospective")) +
  facet_wrap("Disorder_hierarchical")
```

### Plots sum

```{r ocir percentage plot retro_prepan sum}
dat.long.ocir.sum %>%
  ggplot(mapping = aes(
    x = ocir.sum_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "OCI-R scores",
    y = "Percentage of participants",
    fill = "Time point") +
  theme_personal +
  scale_fill_manual(
    values = COPINGpalette3,
    labels = c("Baseline", "Prepandemic", "Retrospective")
  )
```

```{r ocir percentage plot retro_prepan sum resized, fig.height=6, fig.width=10}
dat.long.ocir.sum %>%
  ggplot(mapping = aes(
    x = ocir.sum_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "OCI-R score",
    y = "Percentage of participants",
    fill = "Time point") +
  theme_personal +
  scale_fill_manual(
    values = COPINGpalette3,
    labels = c("Baseline", "Prepandemic", "Retrospective")
  ) +
  facet_wrap("Disorder_hierarchical")
```



Rank the disorders by the size of the change 



PCL:  
Calculate the total GLAD, COPING, RAMP baseline 
## pcl

```{r descriptives pcl.diff_score_cols}
pcl.numeric_table <- dat %>% 
#    group_by(Sample) %>%
  summarise_at( 
    vars(
      "Base - prepan" = pcl.diff_score_base_prepan
    ),
    .funs =
      list(
        ~mean(., na.rm = T),
        ~sd(., na.rm = T),
        ~median(., na.rm = T),
        ~min(., na.rm = T),
        ~max(., na.rm = T),
        ~skew(., na.rm = T),
        kurtosis = ~kurtosi(., na.rm = T)
      )
  )

pcl.numeric_table
```

```{r pcl sum score smart numeric summary tables}
# reshape the table
pcl.numeric_summary_table_reshaped <- pcl.numeric_table %>% 
  gather(key, value) %>% 
  separate(key, c("variable", "measure"), sep = "_") %>%
  mutate(measure = factor(
    x = measure,
    levels =  c( # this is the order I want my columns to appear in
      "missing",
      "min",
      "max",
      "mean", 
      "median", 
      "mode",
      "sd",
      "skew",
      "kurtosis"
    ))) %>% 
  spread(measure, value) %>% 
  # we can apply a function to all variables to edit them so that they are publication ready
  rename_all(
    .funs = ~str_to_title(.)
  ) %>% 
  # or we can individually rename variables 
  rename(
    SD = Sd
  ) 

pcl.numeric_summary_table_reshaped
```

Table for knitting
pcl sum score summary table
```{r pcl sum score summary table}
kable(pcl.numeric_summary_table_reshaped)
```


```{r descriptives pcl.sum_score}
pcl.sum_score_numeric_table <- dat %>% 
#    group_by(Sample) %>%
  summarise_at( 
    vars(
      "Prepan" = pcl.sum_score_prepan,
      "Base" = pcl.sum_score_base
    ),
    .funs =
      list(
        ~mean(., na.rm = T),
        ~sd(., na.rm = T),
        ~median(., na.rm = T),
        ~min(., na.rm = T),
        ~max(., na.rm = T),
        ~skew(., na.rm = T),
        kurtosis = ~kurtosi(., na.rm = T)
      )
  )

pcl.numeric_table
```

```{r pcl diff score smart numeric summary tables}
# reshape the table
pcl.sum_score_numeric_summary_table_reshaped <- pcl.sum_score_numeric_table %>% 
  gather(key, value) %>% 
  separate(key, c("variable", "measure"), sep = "_") %>%
  mutate(measure = factor(
    x = measure,
    levels =  c( # this is the order I want my columns to appear in
      "missing",
      "min",
      "max",
      "mean", 
      "median", 
      "mode",
      "sd",
      "skew",
      "kurtosis"
    ))) %>% 
  spread(measure, value) %>% 
  # we can apply a function to all variables to edit them so that they are publication ready
  rename_all(
    .funs = ~str_to_title(.)
  ) %>% 
  # or we can individually rename variables 
  rename(
    SD = Sd
  ) 

pcl.sum_score_numeric_summary_table_reshaped
```

Table for knitting
pcl diff summary table
```{r pcl diff summary table}
kable(pcl.sum_score_numeric_summary_table_reshaped)
```

```{r pcl gather to long format Time_points pcl.sum_score}
dat.long.pcl.sum <- dat %>%
  gather(
    key = "Time_point_raw",
    value = "pcl.sum_score",
    all_of(pcl.sum_score_cols)) %>%
  select(
    ID,
    Sample,
    Gender_collapsed,
    Ethnicity_collapsed,
    Disorder_hierarchical,
    Time_point_raw,
    pcl.sum_score
  ) %>%
  mutate(Time_point = str_replace(Time_point_raw, "pcl.sum_score_", "")) %>%
  select(-Time_point_raw)

head(dat.long.pcl.sum)
```

For each item 
present percentages of how say that this is due to the pandemic 
```{r pcl percentages due to pandemic}
pcl.retro.items <- c(
  "pcl.stressful_experience_upset_reminded_retro_numeric",
  "pcl.stressful_experience_repeated_images_retro_numeric",
  "pcl.stressful_situation_avoiding_activities_retro_numeric",
  "pcl.cut_people_feeling_distant_retro_numeric",
  "pcl.difficulty_concentrating_retro_numeric",
  "pcl.feeling_irritable_or_having_angry_outbursts_retro_numeric"
)

pcl.percentages.summary <- dat %>%
  select(
    all_of(pcl.retro.items)
  ) %>%
  gather(
    key = "PCL Item",
    value = "Binary_score",
    all_of(pcl.retro.items)
  ) %>%
  mutate(Binary_score = fct_explicit_na(as.factor(Binary_score), na_level = "Missing")) %>%
  group_by(`PCL Item`) %>%
  count(`PCL Item`, Binary_score) %>%
  mutate(prop = round(n/sum(n), 3)*100) %>%
  mutate(n_prop = paste0(n," (",prop, "%)"))

pcl.percentages.summary
```


### Plots sum

```{r pcl percentage plot retro_prepan sum}
dat.long.pcl.sum %>%
  ggplot(mapping = aes(
    x = pcl.sum_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "PCL scores",
    y = "Percentage of participants",
    fill = "Time point") +
  theme_personal +
  scale_fill_manual(
    values = COPINGpalette3,
    labels = c("Baseline", "Prepandemic", "Retrospective")
  )
```

```{r pcl percentage plot retro_prepan sum resized, fig.height=6, fig.width=10}
dat.long.pcl.sum %>%
  ggplot(mapping = aes(
    x = pcl.sum_score,
    y = stat(density*width),
    fill = Time_point)) +
  geom_histogram(
    binwidth = 1,
    position = position_dodge2(preserve = "single")
  ) +
  labs(
    x = "PCL score",
    y = "Percentage of participants",
    fill = "Time point") +
  theme_personal +
  scale_fill_manual(
    values = COPINGpalette3,
    labels = c("Baseline", "Prepandemic", "Retrospective")
  ) +
  facet_wrap("Disorder_hierarchical")
```



# Create additional datasets for analyses
Filter data frame to create 2 additional datasets. Additional exclusion criteria (beyond those listed above) are specified below:

  1. Retrospective - baseline change anlyses
        i. Exclude individuals missing retrospective and/or baseline data
  2. Prepandemic - baseline change analyses
          i. Exclude individuals missing pandemic and/or baseline data
          ii. Exclude individuals with prepandemic data collected after 1st March.

Retro-baseline analyses
Exclude individuals with NA for MHD, age, gender
```{r exclusion criteria for retro-baseline analysis}
dat.retro <- dat %>%
  filter(
    ((data_group_gad == "Baseline and retrospective data" |
      data_group_gad == "All prepandemic, baseline and retrospective data") |
      (data_group_phq == "Baseline and retrospective data" |
      data_group_phq == "All prepandemic, baseline and retrospective data") |
      (data_group_pcl == "Baseline and retrospective data" |
      data_group_pcl == "All prepandemic, baseline and retrospective data") |
      (data_group_ocir == "Baseline and retrospective data" |
      data_group_ocir == "All prepandemic, baseline and retrospective data"))
  )

dim(dat.retro)
```

Prepan-baseline analyses
Exclude individuals with NA for MHD, age, gender; exclude if prepan data collected after 1 March
```{r exclusion criteria for prepan-baseline analysis}
dat.prepan <- dat %>%
  filter(
    ((data_group_gad == "Baseline and retrospective data" |
      data_group_gad == "Prepandemic and baseline data" |
      data_group_gad == "All prepandemic, baseline and retrospective data") |
      (data_group_phq == "Baseline and retrospective data" |
      data_group_phq == "Prepandemic and baseline data" |
      data_group_phq == "All prepandemic, baseline and retrospective data") |
      (data_group_pcl == "Baseline and retrospective data" |
      data_group_pcl == "Prepandemic and baseline data" |
      data_group_pcl == "All prepandemic, baseline and retrospective data") |
      (data_group_ocir == "Baseline and retrospective data" |
      data_group_ocir == "Prepandemic and baseline data" |
      data_group_ocir == "All prepandemic, baseline and retrospective data")) &
      prepandemic_march_1_numeric == 1
  )

dim(dat.prepan)
```

#ANALYSIS PLAN
1. Calculate mean change per disorder group 
    i. Disorders (9)
      a. Rank the disorders by the size of the change
    ii. Sex 
    iii. Age (13; RAMP; potentially collapse above 65 depending on group sizes) 
    iv. Ethnicity groups (5; White European, Black (British), Asian, Arab, Mixed) 

2. Regression models (Regress covariates out of the change? Which?)
    i. Model 0: Disorders  
    ii. Model 1: Model 0 + Sex + Age + Ethnicity + Time registration and baseline 

3. Re-calculate change 

4. Re-rank the change again 

5. PCL:  
    i. Calculate the total GLAD, COPING, RAMP baseline
    ii. For each item:
          a. present percentages of how say that this is due to the pandemic 
          b. Calculate a variable PCL pandemic score 
          c. If one item is highly endorsed due to pandemic -> exclude in sensitivity analysis 

# 1. Calculate mean change per group 


# 2. Regression
Regress covariates out of the change? Which? 

Model naming conventions:
0 - unadjusted
1 - adjusted
a - hierarchical disorders
b - overlapping disorder categories

++MD: We may want to exclude disorders from Model b that aren't including in the hierarchy (e.g. ADHD, ASD)

## Prepan-baseline change

### GAD
Model 0a: Disorder_hierarchical, Unadjusted
```{r GAD prepan Model 0a}
gad_prepan_model0a <- lm(
  formula = gad.diff_score_base_prepan ~ 
    Disorder_hierarchical,
  data = dat.prepan)

summary(gad_prepan_model0a)
tidy(gad_prepan_model0a)
```

Model 0b: Overlapping disorders, Unadjusted
```{r GAD prepan Model 0b}
gad_prepan_model0b <- lm(
  formula = gad.diff_score_base_prepan ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder,
  data = dat.prepan)

summary(gad_prepan_model0b)
tidy(gad_prepan_model0b)
```

Model 1a: Disorder hierarchical, Adjusted
  Model 0a + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r GAD prepan Model 1a}
gad_prepan_model1a <- lm(
  formula = gad.diff_score_base_prepan ~ 
    Disorder_hierarchical + 
    Gender_collapsed + 
    age_category + 
    Ethnicity_collapsed + 
    time_diff_sign_up_coping,
  data = dat.prepan)

summary(gad_prepan_model1a)
tidy(gad_prepan_model1a)
```

Model 1b: Overlapping disorders, Adjusted
  Model 0b + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r GAD prepan Model 1b}
gad_prepan_model1b <- lm(
  formula = gad.diff_score_base_prepan ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder +
    Gender_collapsed + age_category + Ethnicity_collapsed + time_diff_sign_up_coping,
  data = dat.prepan)

summary(gad_prepan_model1b)
tidy(gad_prepan_model1b)
```

### PHQ
Model 0a: Disorder_hierarchical, Unadjusted
```{r PHQ prepan Model 0a}
phq_prepan_model0a <- lm(
  formula = phq.diff_score_base_prepan ~ 
    Disorder_hierarchical,
  data = dat.prepan)

summary(phq_prepan_model0a)
tidy(phq_prepan_model0a)
```

Model 0b: Overlapping disorders, Unadjusted
```{r PHQ prepan Model 0b}
phq_prepan_model0b <- lm(
  formula = phq.diff_score_base_prepan ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder,
  data = dat.prepan)

summary(phq_prepan_model0b)
tidy(phq_prepan_model0b)
```

Model 1a: Disorder hierarchical, Adjusted
  Model 0a + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r PHQ prepan Model 1a}
phq_prepan_model1a <- lm(
  formula = phq.diff_score_base_prepan ~ 
    Disorder_hierarchical + 
    Gender_collapsed + 
    age_category + 
    Ethnicity_collapsed + 
    time_diff_sign_up_coping,
  data = dat.prepan)

summary(phq_prepan_model1a)
tidy(phq_prepan_model1a)
```

Model 1b: Overlapping disorders, Adjusted
  Model 0b + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r PHQ prepan Model 1b}
phq_prepan_model1b <- lm(
  formula = phq.diff_score_base_prepan ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder +
    Gender_collapsed + age_category + Ethnicity_collapsed + time_diff_sign_up_coping,
  data = dat.prepan)

summary(phq_prepan_model1b)
tidy(phq_prepan_model1b)
```


### PCL
Model 0a: Disorder_hierarchical, Unadjusted
```{r PCL prepan Model 0a}
pcl_prepan_model0a <- lm(
  formula = pcl.diff_score_base_prepan ~ 
    Disorder_hierarchical,
  data = dat.prepan)

summary(pcl_prepan_model0a)
tidy(pcl_prepan_model0a)
```

Model 0b: Overlapping disorders, Unadjusted
```{r PCL prepan Model 0b}
pcl_prepan_model0b <- lm(
  formula = pcl.diff_score_base_prepan ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder,
  data = dat.prepan)

summary(pcl_prepan_model0b)
tidy(pcl_prepan_model0b)
```

Model 1a: Disorder hierarchical, Adjusted
  Model 0a + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r PCL prepan Model 1a}
pcl_prepan_model1a <- lm(
  formula = pcl.diff_score_base_prepan ~ 
    Disorder_hierarchical + 
    Gender_collapsed + 
    age_category + 
    Ethnicity_collapsed + 
    time_diff_sign_up_coping,
  data = dat.prepan)

summary(pcl_prepan_model1a)
tidy(pcl_prepan_model1a)
```

Model 1b: Overlapping disorders, Adjusted
  Model 0b + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r PCL prepan Model 1b}
pcl_prepan_model1b <- lm(
  formula = pcl.diff_score_base_prepan ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder +
    Gender_collapsed + age_category + Ethnicity_collapsed + time_diff_sign_up_coping,
  data = dat.prepan)

summary(pcl_prepan_model1b)
tidy(pcl_prepan_model1b)
```

### OCIR
Model 0a: Disorder_hierarchical, Unadjusted
```{r OCIR prepan Model 0a}
ocir_prepan_model0a <- lm(
  formula = ocir.diff_score_base_prepan ~ 
    Disorder_hierarchical,
  data = dat.prepan)

summary(ocir_prepan_model0a)
tidy(ocir_prepan_model0a)
```

Model 0b: Overlapping disorders, Unadjusted
```{r OCIR prepan Model 0b}
ocir_prepan_model0b <- lm(
  formula = ocir.diff_score_base_prepan ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder,
  data = dat.prepan)

summary(ocir_prepan_model0b)
tidy(ocir_prepan_model0b)
```

Model 1a: Disorder hierarchical, Adjusted
  Model 0a + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r OCIR prepan Model 1a}
ocir_prepan_model1a <- lm(
  formula = ocir.diff_score_base_prepan ~ 
    Disorder_hierarchical + 
    Gender_collapsed + 
    age_category + 
    Ethnicity_collapsed + 
    time_diff_sign_up_coping,
  data = dat.prepan)

summary(ocir_prepan_model1a)
tidy(ocir_prepan_model1a)
```

Model 1b: Overlapping disorders, Adjusted
  Model 0b + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r OCIR prepan Model 1b}
ocir_prepan_model1b <- lm(
  formula = ocir.diff_score_base_prepan ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder +
    Gender_collapsed + age_category + Ethnicity_collapsed + time_diff_sign_up_coping,
  data = dat.prepan)

summary(ocir_prepan_model1b)
tidy(ocir_prepan_model1b)
```


## Retro-baseline change

### GAD
Model 0a: Disorder_hierarchical, Unadjusted
```{r GAD retro Model 0a}
gad_retro_model0a <- lm(
  formula = gad.diff_score_base_retro ~ 
    Disorder_hierarchical,
  data = dat.retro)

summary(gad_retro_model0a)
tidy(gad_retro_model0a)
```

Model 0b: Overlapping disorders, Unadjusted
```{r GAD retro Model 0b}
gad_retro_model0b <- lm(
  formula = gad.diff_score_base_retro ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder,
  data = dat.retro)

summary(gad_retro_model0b)
tidy(gad_retro_model0b)
```

Model 1a: Disorder hierarchical, Adjusted
  Model 0a + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r GAD retro Model 1a}
gad_retro_model1a <- lm(
  formula = gad.diff_score_base_retro ~ 
    Disorder_hierarchical + 
    Gender_collapsed + 
    age_category + 
    Ethnicity_collapsed + 
    time_diff_sign_up_coping,
  data = dat.retro)

summary(gad_retro_model1a)
tidy(gad_retro_model1a)
```

Model 1b: Overlapping disorders, Adjusted
  Model 0b + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r GAD retro Model 1b}
gad_retro_model1b <- lm(
  formula = gad.diff_score_base_retro ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder +
    Gender_collapsed + age_category + Ethnicity_collapsed + time_diff_sign_up_coping,
  data = dat.retro)

summary(gad_retro_model1b)
tidy(gad_retro_model1b)
```

### PHQ
Model 0a: Disorder_hierarchical, Unadjusted
```{r PHQ retro Model 0a}
phq_retro_model0a <- lm(
  formula = phq.diff_score_base_retro ~ 
    Disorder_hierarchical,
  data = dat.retro)

summary(phq_retro_model0a)
tidy(phq_retro_model0a)
```

Model 0b: Overlapping disorders, Unadjusted
```{r PHQ retro Model 0b}
phq_retro_model0b <- lm(
  formula = phq.diff_score_base_retro ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder,
  data = dat.retro)

summary(phq_retro_model0b)
tidy(phq_retro_model0b)
```

Model 1a: Disorder hierarchical, Adjusted
  Model 0a + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r PHQ retro Model 1a}
phq_retro_model1a <- lm(
  formula = phq.diff_score_base_retro ~ 
    Disorder_hierarchical + 
    Gender_collapsed + 
    age_category + 
    Ethnicity_collapsed + 
    time_diff_sign_up_coping,
  data = dat.retro)

summary(phq_retro_model1a)
tidy(phq_retro_model1a)
```

Model 1b: Overlapping disorders, Adjusted
  Model 0b + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r PHQ retro Model 1b}
phq_retro_model1b <- lm(
  formula = phq.diff_score_base_retro ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder +
    Gender_collapsed + age_category + Ethnicity_collapsed + time_diff_sign_up_coping,
  data = dat.retro)

summary(phq_retro_model1b)
tidy(phq_retro_model1b)
```


### PCL

++MD: Not sure if this is how we want to run the PCL regression - the outcome variable I've included is "How many PCL items the participants report are related to the pandemic", but I think we might want a more nuanced approach than this.

```{r recode PCL retro variable as numeric}
dat.retro <- dat.retro %>% 
  mutate(
    pcl.sum_score_retro = 
      as.numeric(pcl.sum_score_retro_raw)
  )
```

Model 0a: Disorder_hierarchical, Unadjusted
```{r PCL retro Model 0a}
pcl_retro_model0a <- lm(
  formula = pcl.sum_score_retro ~ 
    Disorder_hierarchical,
  data = dat.retro)

summary(pcl_retro_model0a)
tidy(pcl_retro_model0a)
```

Model 0b: Overlapping disorders, Unadjusted
```{r PCL retro Model 0b}
pcl_retro_model0b <- lm(
  formula = pcl.sum_score_retro ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder,
  data = dat.retro)

summary(pcl_retro_model0b)
tidy(pcl_retro_model0b)
```

Model 1a: Disorder hierarchical, Adjusted
  Model 0a + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r PCL retro Model 1a}
pcl_retro_model1a <- lm(
  formula = pcl.sum_score_retro ~ 
    Disorder_hierarchical + 
    Gender_collapsed + 
    age_category + 
    Ethnicity_collapsed + 
    time_diff_sign_up_coping,
  data = dat.retro)

summary(pcl_retro_model1a)
tidy(pcl_retro_model1a)
```

Model 1b: Overlapping disorders, Adjusted
  Model 0b + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r PCL retro Model 1b}
pcl_retro_model1b <- lm(
  formula = pcl.sum_score_retro ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder +
    Gender_collapsed + age_category + Ethnicity_collapsed + time_diff_sign_up_coping,
  data = dat.retro)

summary(pcl_retro_model1b)
tidy(pcl_retro_model1b)
```

### OCIR
Model 0a: Disorder_hierarchical, Unadjusted
```{r OCIR retro Model 0a}
ocir_retro_model0a <- lm(
  formula = ocir.diff_score_base_retro ~ 
    Disorder_hierarchical,
  data = dat.retro)

summary(ocir_retro_model0a)
tidy(ocir_retro_model0a)
```

Model 0b: Overlapping disorders, Unadjusted
```{r OCIR retro Model 0b}
ocir_retro_model0b <- lm(
  formula = ocir.diff_score_base_retro ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder,
  data = dat.retro)

summary(ocir_retro_model0b)
tidy(ocir_retro_model0b)
```

Model 1a: Disorder hierarchical, Adjusted
  Model 0a + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r OCIR retro Model 1a}
ocir_retro_model1a <- lm(
  formula = ocir.diff_score_base_retro ~ 
    Disorder_hierarchical + 
    Gender_collapsed + 
    age_category + 
    Ethnicity_collapsed + 
    time_diff_sign_up_coping,
  data = dat.retro)

summary(ocir_retro_model1a)
tidy(ocir_retro_model1a)
```

Model 1b: Overlapping disorders, Adjusted
  Model 0b + Sex + Age + Ethnicity_collapsed + Time registration and baseline
```{r OCIR retro Model 1b}
ocir_retro_model1b <- lm(
  formula = ocir.diff_score_base_retro ~
    anxiety_disorders +
    depressive_disorders +
    depression_and_anxiety +
    eating_disorders +
    obsessive_compulsive_disorders +
    psychotic_disorders +
    mhd.mania_hypomania_bipolar_or_manicdepression +
    mhd.posttraumatic_stress_disorder_ptsd +
    autism_spectrum_disorder +
    mhd.attention_deficit_hyperactivity_disorder +
    mhd.personality_disorder +
    Gender_collapsed + age_category + Ethnicity_collapsed + time_diff_sign_up_coping,
  data = dat.retro)

summary(ocir_retro_model1b)
tidy(ocir_retro_model1b)
```







# RUBBISH

+++ Everything underneath here is only SCRATCH

```{r RUBBISH 2, fig.height=7, fig.width=5}
gad.diff_score_base_prepan_plot /
  gad.diff_score_retro_prepan_plot /
  gad.diff_score_base_retro_plot +
  plot_layout(guides = "collect", heights = c(1,1,1)) +
  plot_annotation(tag_levels = "A")
```


